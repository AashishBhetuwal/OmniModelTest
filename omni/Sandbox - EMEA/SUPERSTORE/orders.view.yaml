# Reference this view as superstore__orders
schema: SUPERSTORE
table_name: ORDERS

dimensions:
  created_date_dynamic:
    sql: |
      CASE 
        WHEN {{# superstore__orders.timeframe_selector.filter }} 'Yearly' {{/ superstore__orders.timeframe_selector.filter }} THEN YEAR(${superstore__orders.order_date}) 
        WHEN {{# superstore__orders.timeframe_selector.filter }} 'Quarterly' {{/ superstore__orders.timeframe_selector.filter }} THEN 
          CASE 
            WHEN MONTH(${superstore__orders.order_date}) BETWEEN 1 AND 3 THEN 'March'  -- Q1
            WHEN MONTH(${superstore__orders.order_date}) BETWEEN 4 AND 6 THEN 'June'   -- Q2
            WHEN MONTH(${superstore__orders.order_date}) BETWEEN 7 AND 9 THEN 'September' -- Q3
            WHEN MONTH(${superstore__orders.order_date}) BETWEEN 10 AND 12 THEN 'December' -- Q4
          END
        WHEN {{# superstore__orders.timeframe_selector.filter }} 'Monthly' {{/ superstore__orders.timeframe_selector.filter }} THEN MONTHNAME(${superstore__orders.order_date})
      END
    label: Dynamic Date
    timeframes:
      []
      # Keep this empty to prevent Omni's auto-generation of granularities

  customer_id:
    sql: '"CUSTOMER_ID"'
    format: ID

  order_date:
    sql: '"ORDER_DATE"'

  order_id:
    sql: '"ORDER_ID"'
    format: ID

  order_priority:
    sql: '"ORDER_PRIORITY"'

  row_id:
    sql: '"ROW_ID"'
    format: ID

  discount:
    sql: '"DISCOUNT"'

  profit:
    sql: '"PROFIT"'

  quantity:
    sql: '"QUANTITY"'

  sales:
    sql: '"SALES"'

  product_id:
    sql: '"PRODUCT_ID"'
    format: ID

measures:
  count:
    aggregate_type: count

  profit_sum:
    sql: ${superstore__orders.profit}
    aggregate_type: sum

  quantity_sum:
    sql: ${superstore__orders.quantity}
    aggregate_type: sum

  sales_sum:
    sql: ${superstore__orders.sales}
    aggregate_type: sum

  profit_ratio:
    sql: ${superstore__orders.profit_sum}/${superstore__orders.sales_sum}
    label: Profit Ratio Test 2

filters:
  timeframe_selector:
    type: string
    suggestion_list:
      - value: Yearly
      - value: Quarterly
      - value: Monthly
    default_filter:
      is: Monthly
    filter_single_select_only: true
